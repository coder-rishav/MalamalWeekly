{% extends 'custom_admin/base.html' %}

{% block title %}Create New Game - Admin Panel{% endblock %}
{% block page_title %}Create New Game{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{% url 'custom_admin:games_management' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Games
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-plus-circle"></i> Create New Game</h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Basic Information -->
                    <h6 class="border-bottom pb-2 mb-3">Basic Information</h6>
                    
                    <div class="mb-3">
                        <label for="name" class="form-label">Game Name *</label>
                        <input type="text" class="form-control" id="name" name="name" 
                               placeholder="e.g., Mega Lucky Draw" required>
                        <small class="text-muted">Choose an attractive name for your game</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="game_type" class="form-label">Game Type *</label>
                        <select class="form-select" id="game_type" name="game_type" required onchange="toggleCustomRules()">
                            <option value="">Select game type...</option>
                            <option value="number_match">Number Match - Choose 5 numbers (0-99)</option>
                            <option value="lucky_draw">Lucky Draw - Choose 1 number (1-100)</option>
                            <option value="color_game">Color Prediction - Choose a color</option>
                            <option value="custom">ðŸŽ® Custom Game (Define Your Own Rules)</option>
                        </select>
                        <small class="text-muted">This defines how users play and win</small>
                    </div>
                    
                    <!-- Custom Game Rules Builder (Hidden by default) -->
                    <div id="custom_rules_section" style="display: none;" class="border rounded p-3 mb-3 bg-light">
                        <h6 class="text-primary"><i class="bi bi-gear-fill"></i> Custom Game Configuration</h6>
                        <p class="small text-muted">Define how users will play your custom game</p>
                        
                        <div class="mb-3">
                            <label for="input_type" class="form-label">Input Type *</label>
                            <select class="form-select" id="input_type" name="input_type" onchange="toggleInputOptions()">
                                <option value="">Select input type...</option>
                                <option value="number">Number Selection</option>
                                <option value="choice">Multiple Choice</option>
                                <option value="text">Text Answer</option>
                            </select>
                            <small class="text-muted">How will users submit their entry?</small>
                        </div>
                        
                        <!-- Number Input Options -->
                        <div id="number_options" style="display: none;" class="border-start border-3 border-primary ps-3 mb-3">
                            <h6 class="small fw-bold">Number Configuration</h6>
                            <div class="row">
                                <div class="col-md-4 mb-2">
                                    <label for="number_count" class="form-label small">How Many Numbers?</label>
                                    <input type="number" class="form-control form-control-sm" id="number_count" name="number_count" value="1" min="1" max="10">
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label for="min_value" class="form-label small">Min Value</label>
                                    <input type="number" class="form-control form-control-sm" id="min_value" name="min_value" value="1">
                                </div>
                                <div class="col-md-4 mb-2">
                                    <label for="max_value" class="form-label small">Max Value</label>
                                    <input type="number" class="form-control form-control-sm" id="max_value" name="max_value" value="100">
                                </div>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="allow_duplicates" name="allow_duplicates">
                                <label class="form-check-label small" for="allow_duplicates">
                                    Allow duplicate numbers
                                </label>
                            </div>
                        </div>
                        
                        <!-- Choice Input Options -->
                        <div id="choice_options" style="display: none;" class="border-start border-3 border-success ps-3 mb-3">
                            <h6 class="small fw-bold">Multiple Choice Configuration</h6>
                            <div class="mb-2">
                                <label for="choices" class="form-label small">Choices (one per line)</label>
                                <textarea class="form-control form-control-sm" id="choices" name="choices" rows="4" 
                                          placeholder="Red&#10;Blue&#10;Green&#10;Yellow"></textarea>
                                <small class="text-muted">Enter each option on a new line</small>
                            </div>
                            <div class="form-check mb-2">
                                <input type="checkbox" class="form-check-input" id="multiple_selection" name="multiple_selection" onchange="toggleSelectionCount()">
                                <label class="form-check-label small" for="multiple_selection">
                                    Allow multiple selections
                                </label>
                            </div>
                            <div id="selection_count_div" style="display: none;">
                                <label for="selection_count" class="form-label small">Number of Selections</label>
                                <input type="number" class="form-control form-control-sm" id="selection_count" name="selection_count" value="1" min="1">
                            </div>
                        </div>
                        
                        <!-- Text Input Options -->
                        <div id="text_options" style="display: none;" class="border-start border-3 border-warning ps-3 mb-3">
                            <h6 class="small fw-bold">Text Answer Configuration</h6>
                            <div class="row">
                                <div class="col-md-6 mb-2">
                                    <label for="min_length" class="form-label small">Min Length</label>
                                    <input type="number" class="form-control form-control-sm" id="min_length" name="min_length" value="1" min="1">
                                </div>
                                <div class="col-md-6 mb-2">
                                    <label for="max_length" class="form-label small">Max Length</label>
                                    <input type="number" class="form-control form-control-sm" id="max_length" name="max_length" value="100" min="1">
                                </div>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="case_sensitive" name="case_sensitive">
                                <label class="form-check-label small" for="case_sensitive">
                                    Case sensitive matching
                                </label>
                            </div>
                        </div>
                        
                        <!-- Winning Logic -->
                        <div class="mb-3">
                            <label for="winning_logic" class="form-label">Winning Logic *</label>
                            <select class="form-select" id="winning_logic" name="winning_logic">
                                <option value="exact_match">Exact Match - Must match completely</option>
                                <option value="partial_match">Partial Match - Points for partial matches</option>
                                <option value="closest">Closest Match - Nearest wins</option>
                                <option value="random">Random - One random winner</option>
                            </select>
                        </div>
                        
                        <div id="partial_match_div" style="display: none;" class="mb-3">
                            <label for="partial_match_points" class="form-label small">Points per Partial Match</label>
                            <input type="number" class="form-control" id="partial_match_points" name="partial_match_points" value="0" min="0">
                            <small class="text-muted">For partial match scoring (e.g., 1 point per correct number)</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description *</label>
                        <textarea class="form-control" id="description" name="description" 
                                  rows="3" placeholder="Brief description of the game..." required></textarea>
                        <small class="text-muted">This appears on the game card</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="rules" class="form-label">Game Rules *</label>
                        <textarea class="form-control" id="rules" name="rules" 
                                  rows="5" placeholder="Explain how to play and win..." required></textarea>
                        <small class="text-muted">Clear instructions for users</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="image" class="form-label">Game Image</label>
                        <input type="file" class="form-control" id="image" name="image" accept="image/*">
                        <small class="text-muted">Upload an attractive image (recommended: 800x600px)</small>
                    </div>
                    
                    <!-- Financial Settings -->
                    <h6 class="border-bottom pb-2 mb-3 mt-4">Financial Settings</h6>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="entry_fee" class="form-label">Entry Fee (â‚¹) *</label>
                            <input type="number" class="form-control" id="entry_fee" name="entry_fee" 
                                   placeholder="50" step="0.01" min="0" required>
                            <small class="text-muted">Cost to participate</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="winning_amount" class="form-label">Prize Amount (â‚¹) *</label>
                            <input type="number" class="form-control" id="winning_amount" name="winning_amount" 
                                   placeholder="10000" step="0.01" min="0" required>
                            <small class="text-muted">Winner's prize</small>
                        </div>
                    </div>
                    
                    <!-- Participant Settings -->
                    <h6 class="border-bottom pb-2 mb-3 mt-4">Participant Settings</h6>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="min_participants" class="form-label">Minimum Participants *</label>
                            <input type="number" class="form-control" id="min_participants" name="min_participants" 
                                   value="2" min="1" required>
                            <small class="text-muted">Required to start a round</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="max_participants" class="form-label">Maximum Participants *</label>
                            <input type="number" class="form-control" id="max_participants" name="max_participants" 
                                   value="1000" min="1" required>
                            <small class="text-muted">Entry limit per round</small>
                        </div>
                    </div>
                    
                    <!-- Status Settings -->
                    <h6 class="border-bottom pb-2 mb-3 mt-4">Status & Visibility</h6>
                    
                    <div class="mb-3">
                        <label for="status" class="form-label">Game Status *</label>
                        <select class="form-select" id="status" name="status" required>
                            <option value="active" selected>Active - Available for play</option>
                            <option value="inactive">Inactive - Hidden from users</option>
                            <option value="maintenance">Maintenance - Coming soon</option>
                        </select>
                    </div>
                    
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="is_featured" name="is_featured">
                        <label class="form-check-label" for="is_featured">
                            <strong>Featured Game</strong> - Show on homepage for better visibility
                        </label>
                    </div>
                    
                    <!-- Buttons -->
                    <div class="mt-4">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-plus-circle"></i> Create Game
                        </button>
                        <a href="{% url 'custom_admin:games_management' %}" class="btn btn-secondary btn-lg">
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Help Sidebar -->
    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0"><i class="bi bi-lightbulb"></i> Game Type Guide</h6>
            </div>
            <div class="card-body">
                <h6><i class="bi bi-1-circle"></i> Number Match</h6>
                <p class="small">Users select 5 numbers (0-99). Win by matching all 5 in exact sequence.</p>
                
                <h6><i class="bi bi-2-circle"></i> Lucky Draw</h6>
                <p class="small">Users pick 1 number (1-100). Win by matching the lucky number.</p>
                
                <h6><i class="bi bi-3-circle"></i> Color Prediction</h6>
                <p class="small">Users choose a color (Red/Green/Blue/Yellow). Win by matching the winning color.</p>
                
                <h6><i class="bi bi-4-circle"></i> Custom Game</h6>
                <p class="small">For future custom game types you'll develop.</p>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Tips for Success</h6>
            </div>
            <div class="card-body">
                <ul class="mb-0 small">
                    <li><strong>Attractive Names:</strong> Use exciting names like "Mega", "Super", "Lucky"</li>
                    <li><strong>Fair Pricing:</strong> Balance entry fee vs prize for profitability</li>
                    <li><strong>Clear Rules:</strong> Write simple, easy-to-understand instructions</li>
                    <li><strong>Good Image:</strong> Use colorful, eye-catching images</li>
                    <li><strong>Test First:</strong> Set to "Inactive" to test before launch</li>
                    <li><strong>Custom Games:</strong> Define clear winning logic for fairness</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function toggleCustomRules() {
    const gameType = document.getElementById('game_type').value;
    const customSection = document.getElementById('custom_rules_section');
    
    if (gameType === 'custom') {
        customSection.style.display = 'block';
    } else {
        customSection.style.display = 'none';
    }
}

function toggleInputOptions() {
    const inputType = document.getElementById('input_type').value;
    
    // Hide all options first
    document.getElementById('number_options').style.display = 'none';
    document.getElementById('choice_options').style.display = 'none';
    document.getElementById('text_options').style.display = 'none';
    
    // Show selected option
    if (inputType === 'number') {
        document.getElementById('number_options').style.display = 'block';
    } else if (inputType === 'choice') {
        document.getElementById('choice_options').style.display = 'block';
    } else if (inputType === 'text') {
        document.getElementById('text_options').style.display = 'block';
    }
}

function toggleSelectionCount() {
    const multipleSelection = document.getElementById('multiple_selection').checked;
    const selectionCountDiv = document.getElementById('selection_count_div');
    
    if (multipleSelection) {
        selectionCountDiv.style.display = 'block';
    } else {
        selectionCountDiv.style.display = 'none';
    }
}

// Show partial match options when partial_match winning logic is selected
document.addEventListener('DOMContentLoaded', function() {
    const winningLogic = document.getElementById('winning_logic');
    if (winningLogic) {
        winningLogic.addEventListener('change', function() {
            const partialMatchDiv = document.getElementById('partial_match_div');
            if (this.value === 'partial_match') {
                partialMatchDiv.style.display = 'block';
            } else {
                partialMatchDiv.style.display = 'none';
            }
        });
    }
});
</script>
{% endblock %}
